---
import "../../styles/global.css";
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection, render } from "astro:content";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  return posts.map((post) => ({
    params: { slug: post.id },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);

const formattedDate = new Date(post.data.date).toLocaleDateString("en-US", {
  year: "numeric",
  month: "long",
  day: "numeric",
});
---

<BaseLayout
  title={`${post.data.title} — Agent Fan Club`}
  description={post.data.description}
  og={{
    type: "article",
    article: {
      author: post.data.author,
      publishedTime: new Date(post.data.date).toISOString(),
      tags: post.data.topics,
    },
  }}
>
  <header class="sticky top-0 z-50 border-b-2 border-stone-950 bg-stone-50/95 backdrop-blur-sm">
    <div class="mx-auto flex w-full max-w-[1600px] items-center justify-between px-6 py-6 md:px-8">
      <a href="/" class="group flex items-center gap-4">
        <span class="font-['JetBrains_Mono'] text-xs font-semibold tracking-[0.1em] text-blue-700 transition-all duration-200 group-hover:-translate-x-1">
          ←
        </span>
        <span class="text-2xl font-bold tracking-tight md:text-[28px]">Agent Fan Club</span>
      </a>

      <a
        href="https://discord.gg/gWUnUwenSV"
        target="_blank"
        rel="noopener noreferrer"
        class="group relative overflow-hidden bg-stone-950 px-6 py-3 font-['JetBrains_Mono'] text-xs font-semibold tracking-[0.1em] text-stone-50 md:px-8"
      >
        <span class="relative z-10 transition-colors duration-300 group-hover:text-stone-50">Join Discord</span>
        <span class="absolute inset-0 translate-y-full bg-blue-700 transition-transform duration-300 group-hover:translate-y-0"></span>
      </a>
    </div>
  </header>

  <main class="mx-auto w-full max-w-[1600px] px-6 md:px-8">
    <article class="mx-auto max-w-3xl py-16 md:py-24">
      <a
        href="/blogs"
        class="group mb-12 inline-flex items-center gap-2 font-['JetBrains_Mono'] text-xs font-semibold tracking-[0.1em] text-stone-950/60 transition-colors duration-200 hover:text-blue-700"
      >
        <span class="transition-transform duration-200 group-hover:-translate-x-1">←</span>
        Back to all posts
      </a>

      <header class="mb-16 border-l-[3px] border-blue-700 pl-8">
        <div class="mb-6 flex flex-wrap items-center gap-4">
          {
            post.data.topics.map((topic: string) => (
              <span class="border border-blue-700/30 bg-blue-50 px-2 py-1 font-['JetBrains_Mono'] text-[10px] font-semibold text-blue-700">
                {topic}
              </span>
            ))
          }
        </div>

        <h1 class="mb-6 text-3xl font-bold leading-tight tracking-tight md:text-5xl">
          {post.data.title}
        </h1>

        <p class="mb-8 text-lg leading-relaxed text-stone-950/70">
          {post.data.description}
        </p>

        <div class="flex flex-wrap items-center gap-6 border-t-2 border-stone-950/10 pt-6">
          <span class="text-sm font-medium text-stone-950/80">
            {post.data.author}
          </span>
          <span class="font-['JetBrains_Mono'] text-[11px] font-semibold tracking-[0.05em] text-stone-600">
            {formattedDate}
          </span>
          <span class="font-['JetBrains_Mono'] text-[11px] text-stone-950/40">
            {post.data.readTime}
          </span>
        </div>
      </header>

      <div class="prose">
        <Content />
      </div>

      <footer class="mt-16 border-t-2 border-stone-950 pt-8">
        <a
          href="/blogs"
          class="group/btn relative inline-block overflow-hidden border-2 border-stone-950 px-8 py-4"
        >
          <span class="relative z-10 font-['JetBrains_Mono'] text-xs font-bold tracking-[0.1em] transition-colors duration-300 group-hover/btn:text-stone-50">
            ← All Posts
          </span>
          <span class="absolute inset-0 translate-y-full bg-stone-950 transition-transform duration-300 group-hover/btn:translate-y-0"></span>
        </a>
      </footer>
    </article>
  </main>
</BaseLayout>

<style is:global>
  .prose {
    font-size: 1.0625rem;
    line-height: 1.8;
    color: oklch(0.28 0.006 285);
  }

  .prose h2 {
    font-size: 1.75rem;
    font-weight: 700;
    letter-spacing: -0.01em;
    margin-top: 3rem;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid oklch(0.28 0.006 285 / 0.1);
    color: oklch(0.28 0.006 285);
  }

  .prose h3 {
    font-size: 1.25rem;
    font-weight: 600;
    letter-spacing: -0.005em;
    margin-top: 2rem;
    margin-bottom: 0.75rem;
    color: oklch(0.28 0.006 285);
  }

  .prose p {
    margin-bottom: 1.25rem;
  }

  .prose a {
    color: oklch(0.488 0.243 264.376);
    text-decoration: underline;
    text-underline-offset: 3px;
    text-decoration-thickness: 1px;
    transition: color 0.2s;
  }

  .prose a:hover {
    color: oklch(0.28 0.006 285);
  }

  .prose strong {
    font-weight: 600;
    color: oklch(0.28 0.006 285);
  }

  .prose em {
    font-style: italic;
  }

  .prose ul {
    margin-top: 0.75rem;
    margin-bottom: 1.25rem;
    padding-left: 1.5rem;
    list-style: none;
  }

  .prose ul li {
    position: relative;
    padding-left: 1rem;
    margin-bottom: 0.5rem;
  }

  .prose ul li::before {
    content: "▪";
    position: absolute;
    left: 0;
    color: oklch(0.488 0.243 264.376);
    font-size: 0.625rem;
    top: 0.45em;
  }

  .prose ol {
    margin-top: 0.75rem;
    margin-bottom: 1.25rem;
    padding-left: 1.5rem;
    list-style: decimal;
  }

  .prose ol li {
    padding-left: 0.25rem;
    margin-bottom: 0.5rem;
  }

  .prose ol li::marker {
    font-family: "JetBrains Mono", monospace;
    font-size: 0.8em;
    font-weight: 600;
    color: oklch(0.488 0.243 264.376);
  }

  .prose blockquote {
    border-left: 3px solid oklch(0.488 0.243 264.376);
    padding-left: 1.5rem;
    margin-top: 1.5rem;
    margin-bottom: 1.5rem;
    font-style: italic;
    color: oklch(0.28 0.006 285 / 0.7);
  }

  .prose code {
    font-family: "JetBrains Mono", monospace;
    font-size: 0.85em;
    background: oklch(0.28 0.006 285 / 0.06);
    padding: 0.15em 0.4em;
    border: 1px solid oklch(0.28 0.006 285 / 0.1);
  }

  .prose pre {
    font-family: "JetBrains Mono", monospace;
    font-size: 0.85rem;
    line-height: 1.7;
    background: oklch(0.28 0.006 285);
    color: oklch(0.97 0.001 285);
    padding: 1.25rem 1.5rem;
    margin-top: 1.5rem;
    margin-bottom: 1.5rem;
    overflow-x: auto;
    border-left: 3px solid oklch(0.488 0.243 264.376);
  }

  .prose pre code {
    background: none;
    padding: 0;
    border: none;
    color: inherit;
  }

  .prose hr {
    border: none;
    border-top: 2px solid oklch(0.28 0.006 285 / 0.1);
    margin-top: 2.5rem;
    margin-bottom: 2.5rem;
  }

  .prose img {
    max-width: 100%;
    margin-top: 1.5rem;
    margin-bottom: 1.5rem;
    border: 2px solid oklch(0.28 0.006 285 / 0.1);
  }
</style>
