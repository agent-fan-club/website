---
import SectionLabel from "../ui/SectionLabel.astro";
import { getCollection } from 'astro:content';

const leadersCollection = await getCollection('leadership');
leadersCollection.sort((a, b) => a.data.order - b.data.order);

const leaders = leadersCollection.map((leader) => ({
  name: leader.data.name,
  role: leader.data.role,
  focus: leader.data.focus,
  email: leader.data.email,
}));

const discordStats = await getCollection('discordStats');
const membersEntry = discordStats.find((s) => s.id === 'members');
const memberCount = membersEntry
  ? membersEntry.data.value.replace(/\D+$/, '')
  : '—';

const hierarchyLines = [
  "├─ Exec Board (2)",
  "├─ Project Leads (3)",
  `├─ Active Members (${memberCount})`,
  "└─ Community Contributors (∞)",
];
---

<section id="leadership" class="relative overflow-hidden border-t-2 border-stone-950 py-20 md:py-24 scroll-mt-24">
  <div
    class="pointer-events-none absolute inset-0 opacity-20 [background:radial-gradient(circle_at_70%_30%,rgba(0,71,255,0.12)_0%,transparent_60%)]"
    aria-hidden="true"
  ></div>

  <div class="relative mx-auto grid w-full max-w-[1600px] grid-cols-12 gap-8 px-6 md:px-8 lg:gap-12">
    <div class="col-span-12 space-y-8 lg:col-span-5">
      <SectionLabel number="2.0" title="Organization Structure" />

      <div class="space-y-5 text-base leading-relaxed">
        <p class="opacity-90">Executive Board and Project Lead positions are appointed by current leadership based on activity and expertise.</p>
      </div>

      <div
        class="group relative mt-12 overflow-hidden bg-stone-950 p-6 text-stone-50 transition-all duration-300 hover:shadow-[8px_8px_0px_0px_rgba(107,163,255,1)]"
      >
        <div
          class="absolute right-0 top-0 h-32 w-32 bg-blue-400/10 blur-3xl transition-opacity duration-500 group-hover:bg-blue-400/20"
          aria-hidden="true"
        ></div>

        <p class="relative z-10 mb-6 font-['JetBrains_Mono'] text-[11px] font-bold tracking-[0.15em] text-stone-400">
          Organizational Hierarchy
        </p>
        <div class="relative z-10 space-y-2 font-['JetBrains_Mono'] text-sm leading-loose">
          {
            hierarchyLines.map((line) => (
              <p class="transition-all duration-200 hover:translate-x-2 hover:text-blue-400">{line}</p>
            ))
          }
        </div>
      </div>
    </div>

    <div class="col-span-12 space-y-4 lg:col-span-7">
      {
        leaders.map((leader, index) => (
          <article class="group relative border-2 border-stone-950 bg-white p-6 transition-all duration-300 hover:-translate-x-[2px] hover:-translate-y-[2px] hover:border-blue-700 hover:shadow-[6px_6px_0px_0px_rgba(0,71,255,1)] md:p-8">
            <div class="absolute right-0 top-0 h-12 w-12 overflow-hidden">
              <div class="absolute right-0 top-0 h-0 w-0 border-r-[24px] border-t-[24px] border-r-transparent border-t-blue-700 opacity-0 transition-opacity duration-300 group-hover:opacity-100"></div>
            </div>

            <div class="grid grid-cols-1 gap-6 md:grid-cols-3">
              <div>
                <p class="mb-2 font-['JetBrains_Mono'] text-xs font-bold tracking-[0.1em] text-blue-700">2.{index + 1}</p>
                <p class="text-2xl font-semibold transition-transform duration-200 group-hover:translate-x-1">{leader.name}</p>
                <a
                  href={`mailto:${leader.email}`}
                  class="mt-2 block font-['JetBrains_Mono'] text-xs opacity-60 transition-colors duration-200 hover:text-blue-700"
                >
                  {leader.email}
                </a>
              </div>

              <div>
                <p class="mb-2 font-['JetBrains_Mono'] text-[11px] font-semibold tracking-[0.1em] text-stone-600">Position</p>
                <p class="text-base">{leader.role}</p>
              </div>

              <div>
                <p class="mb-2 font-['JetBrains_Mono'] text-[11px] font-semibold tracking-[0.1em] text-stone-600">Focus Area</p>
                <p class="text-base leading-relaxed">{leader.focus}</p>
              </div>
            </div>
          </article>
        ))
      }

      <div class="relative mt-8 overflow-hidden border-l-[3px] border-blue-700 bg-blue-50 p-6">
        <div class="absolute left-0 top-0 h-full w-1 animate-pulse bg-blue-700" aria-hidden="true"></div>
        <p class="mb-2 ml-4 font-['JetBrains_Mono'] text-[10px] font-bold tracking-[0.15em] text-blue-700">◆ NOTE</p>
        <p class="ml-4 text-sm leading-relaxed">
          Please contact a current exec member if you are interested in serving on our exec board.
        </p>
      </div>
    </div>
  </div>
</section>
